<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ğŸ”¥ Descontos Amazon atÃ© 74% HOJE | PromoHunter Portugal</title>
  
  <!-- SEO -->
  <meta name="description" content="Ofertas Amazon verificadas a cada hora. AtÃ© 74% desconto. Frete GRÃTIS. Produtos esgotam rÃ¡pido!">
  <meta name="keywords" content="descontos amazon, ofertas relÃ¢mpago amazon, promoÃ§Ãµes amazon portugal, black friday amazon">
  
  <!-- Open Graph -->
  <meta property="og:title" content="ğŸ”¥ Descontos Amazon atÃ© 74% - SÃ³ Hoje!">
  <meta property="og:description" content="Ofertas verificadas. Poupa atÃ© â‚¬200! Esgota rÃ¡pido.">
  <meta property="og:image" content="https://your-domain.com/og-image.jpg">
  
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(250, 204, 21, 0.5); }
      50% { box-shadow: 0 0 40px rgba(250, 204, 21, 0.8); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }
    
    @keyframes countdown-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .product-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: fadeIn 0.5s ease-out;
    }
    
    .product-card:hover {
      transform: translateY(-12px) scale(1.03);
      box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    }
    
    .destaque {
      border: 4px solid #facc15;
      animation: pulse-glow 2s ease-in-out infinite;
      position: relative;
      background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
    }
    
    .destaque::before {
      content: 'â­ MELHOR NEGÃ“CIO';
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      color: #000;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 900;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .hero-gradient {
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 50%, #ea580c 100%);
    }
    
    .badge-novo {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      animation: shake 0.5s ease-in-out infinite;
    }
    
    .badge-esgota {
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      animation: countdown-pulse 1s ease-in-out infinite;
    }
    
    .trust-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-size: 13px;
      font-weight: 600;
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s ease-in-out infinite;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .cta-primary {
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .cta-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
    }
    
    .cta-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }
    
    .cta-primary:hover::before {
      left: 100%;
    }
    
    #scrollTop {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      color: #000;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 1000;
      font-size: 24px;
      font-weight: bold;
    }
    
    #scrollTop.show {
      opacity: 1;
    }
    
    #scrollTop:hover {
      transform: translateY(-6px);
    }
    
    .countdown-timer {
      font-family: 'Courier New', monospace;
      font-size: 20px;
      font-weight: bold;
      color: #dc2626;
    }
    
    @media (max-width: 640px) {
      .hero-section h1 {
        font-size: 28px;
      }
      .header-controls {
        flex-direction: column;
        width: 100%;
      }
      .header-controls > * {
        width: 100%;
        margin-bottom: 8px;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- Trust Bar (topo fixo) -->
<div class="bg-gradient-to-r from-green-600 to-green-500 text-white text-center py-2 text-sm font-semibold">
  âœ… Ofertas verificadas a cada hora | ğŸšš Frete GRÃTIS em muitos produtos | â­ Garantia Amazon
</div>

<!-- Header -->
<header class="bg-white shadow-lg sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center space-x-3">
        <img src="logox.png" alt="PromoZon" class="h-12 w-12">
        <div>
          <h1 class="text-2xl font-black bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent">
            PromoZon
          </h1>
          <p class="text-xs text-gray-600 font-semibold">Atualizado a cada hora</p>
        </div>
      </div>
      
      <div class="hidden md:flex items-center space-x-4 text-sm">
        <div class="flex items-center space-x-2 bg-green-50 px-3 py-2 rounded-lg">
          <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          <span class="text-green-700 font-bold" id="liveCount">0 ofertas ativas</span>
        </div>
      </div>
    </div>
    
    <!-- Filters -->
    <div class="header-controls flex items-center gap-3">
      <input 
        id="search" 
        type="text"
        placeholder="ğŸ” O que procuras? Ex: Aspirador, TV..." 
        class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none transition-all text-base font-medium" 
      />
      <select id="categoryFilter" class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none bg-white text-base font-medium">
        <option value="">ğŸ“ Todas</option>
      </select>
      <select id="sortSelect" class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none bg-white text-base font-medium">
        <option value="promo_desc">ğŸ”¥ Maior desconto</option>
        <option value="price_asc">ğŸ’° Mais barato</option>
        <option value="price_desc">ğŸ’ Mais caro</option>
        <option value="newest">ğŸ†• Mais recentes</option>
      </select>
    </div>
  </div>
</header>

<!-- Hero Section -->
<section class="hero-gradient py-12 text-center">
  <div class="max-w-4xl mx-auto px-4">
    <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-4 leading-tight">
      Poupa atÃ© <span class="text-white">â‚¬200</span> Hoje! ğŸ‰
    </h2>
    <p class="text-xl md:text-2xl text-gray-800 font-bold mb-6">
      Ofertas Amazon verificadas â€¢ AtÃ© 74% desconto â€¢ Esgotam rÃ¡pido!
    </p>
    
    <!-- Trust Badges -->
    <div class="flex flex-wrap justify-center gap-4 mb-6">
      <div class="trust-badge">
        <span class="text-green-600 text-lg">âœ“</span>
        <span class="text-gray-800">Verificado Amazon</span>
      </div>
      <div class="trust-badge">
        <span class="text-blue-600 text-lg">ğŸšš</span>
        <span class="text-gray-800">Frete GrÃ¡tis</span>
      </div>
      <div class="trust-badge">
        <span class="text-yellow-600 text-lg">âš¡</span>
        <span class="text-gray-800">Entrega RÃ¡pida</span>
      </div>
      <div class="trust-badge">
        <span class="text-red-600 text-lg">ğŸ”¥</span>
        <span class="text-gray-800">Esgota RÃ¡pido</span>
      </div>
    </div>
    
    <!-- Countdown Timer -->
    <div class="bg-white rounded-2xl px-8 py-4 inline-block shadow-2xl">
      <p class="text-sm text-gray-600 font-semibold mb-2">â° PrÃ³xima atualizaÃ§Ã£o em:</p>
      <div class="countdown-timer" id="countdown">--:--:--</div>
    </div>
  </div>
</section>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 py-8">
  
  <!-- Stats Bar -->
  <section class="mb-6 flex items-center justify-between bg-white rounded-xl px-6 py-4 shadow">
    <div>
      <span class="text-3xl font-black text-yellow-600" id="statsCount">0</span>
      <span class="text-gray-600 font-semibold ml-2">ofertas encontradas</span>
    </div>
    <div class="text-sm text-gray-500 hidden md:block">
      ğŸ’¡ <strong>Dica:</strong> Produtos com desconto >50% esgotam em minutos!
    </div>
  </section>
  
  <!-- Loading Skeleton -->
  <section id="loadingSkeleton" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <!-- Filled by JS -->
  </section>
  
  <!-- Products Grid -->
  <section id="grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 hidden"></section>
  
  <!-- Pagination -->
  <nav id="pagination" class="mt-12 flex justify-center items-center gap-2"></nav>
</main>

<!-- Social Proof Section -->
<section class="bg-gradient-to-r from-blue-50 to-purple-50 py-16 mt-16">
  <div class="max-w-6xl mx-auto px-4 text-center">
    <h3 class="text-3xl font-black text-gray-900 mb-8">JÃ¡ pouparam milhares de euros ğŸ’°</h3>
    <div class="grid md:grid-cols-3 gap-8">
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="text-5xl mb-4">ğŸ˜</div>
        <p class="text-gray-700 italic mb-4">"Comprei o aspirador que queria hÃ¡ meses por -63%! IncrÃ­vel!"</p>
        <p class="font-bold text-gray-900">â€” Maria, Lisboa</p>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="text-5xl mb-4">ğŸ”¥</div>
        <p class="text-gray-700 italic mb-4">"Todos os dias encontro ofertas novas. JÃ¡ poupei +â‚¬300 este mÃªs."</p>
        <p class="font-bold text-gray-900">â€” JoÃ£o, Porto</p>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="text-5xl mb-4">âš¡</div>
        <p class="text-gray-700 italic mb-4">"Melhor que Black Friday! Verificam os preÃ§os, confio 100%."</p>
        <p class="font-bold text-gray-900">â€” Ana, Braga</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-gray-900 text-white mt-16 py-12">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <div class="mb-6">
      <h2 class="text-2xl font-black text-yellow-400 mb-2">PromoZon</h2>
      <p class="text-gray-400">As melhores ofertas Amazon, verificadas para ti</p>
    </div>
    
    <div class="flex flex-wrap justify-center gap-6 mb-6 text-sm">
      <a href="#" class="hover:text-yellow-400 transition">Sobre NÃ³s</a>
      <a href="#" class="hover:text-yellow-400 transition">Como Funciona</a>
      <a href="#" class="hover:text-yellow-400 transition">PolÃ­tica de Privacidade</a>
      <a href="#" class="hover:text-yellow-400 transition">Contacto</a>
    </div>
    
    <p class="text-xs text-gray-500">
      âš ï¸ Os preÃ§os sÃ£o atualizados regularmente. Confirme sempre o preÃ§o final na Amazon.<br>
      PromoZon Ã© um afiliado Amazon. Ganhamos comissÃ£o em compras qualificadas.
    </p>
    
    <p class="text-xs text-gray-600 mt-4">
      Â© 2026 PromoZon. Criado com â¤ï¸ para poupar o teu dinheiro.
    </p>
  </div>
</footer>

<!-- Scroll to Top -->
<button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Voltar ao topo">
  â†‘
</button>

<script>
// ============ CONFIG ============
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzXV2COi6q6327Son0xN9pXKK3vWkmMc0FRp6m25MXzJsBbqg80GAR_qvNhP9pFW9JzWA/exec';
const PAGE_SIZE = 24;
const HOURS_FOR_NEW_BADGE = 48;
const NEXT_UPDATE_HOURS = 1; // PrÃ³xima atualizaÃ§Ã£o em 1h

let PRODUCTS = [];
let currentPage = 1;

const CATEGORY_ICONS = {
  'ElectrÃ³nica': 'ğŸ’»',
  'Cocina y Hogar': 'ğŸ ',
  'Animais PET': 'ğŸ¾',
  'Ferramentas Electricas': 'ğŸ”§',
  'Desporto': 'âš½',
  'Beleza': 'ğŸ’„',
  'SaÃºde e Lar': 'ğŸ¥',
  'default': 'ğŸ“¦'
};

// ============ COUNTDOWN TIMER ============
function startCountdown() {
  const updateCountdown = () => {
    const now = new Date();
    const nextHour = new Date(now);
    nextHour.setHours(now.getHours() + NEXT_UPDATE_HOURS, 0, 0, 0);
    
    const diff = nextHour - now;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const secs = Math.floor((diff % (1000 * 60)) / 1000);
    
    const display = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    document.getElementById('countdown').textContent = display;
  };
  
  updateCountdown();
  setInterval(updateCountdown, 1000);
}

// ============ UTILITIES ============
function fetchProducts() {
  return fetch(WEB_APP_URL).then(res => res.json());
}

function toNumber(v) {
  if (!v) return null;
  let s = String(v).trim().replace(',', '.').replace(/[^0-9.\-]/g, '');
  const n = parseFloat(s);
  return isNaN(n) ? null : n;
}

function parseDate(dateStr) {
  if (!dateStr) return null;
  const formats = [
    /(\d{1,2})\/(\d{1,2})\/(\d{4})/,
    /(\d{4})-(\d{2})-(\d{2})/,
  ];
  for (const format of formats) {
    const match = String(dateStr).match(format);
    if (match) {
      if (format === formats[0]) {
        return new Date(match[3], match[2] - 1, match[1]);
      } else {
        return new Date(match[1], match[2] - 1, match[3]);
      }
    }
  }
  return null;
}

function isNew(dateAdded) {
  if (!dateAdded) return false;
  const now = new Date();
  const diff = now - dateAdded;
  const hours = diff / (1000 * 60 * 60);
  return hours <= HOURS_FOR_NEW_BADGE;
}

function getShareText(product) {
  const discount = product.promocao && product.preco 
    ? Math.round((1 - product.promocao / product.preco) * 100)
    : 0;
  
  let text = `ğŸ”¥ OFERTA AMAZON!\n\n${product.titulo}\n\n`;
  
  if (discount > 0 && product.preco && product.promocao) {
    text += `ğŸ’° ${discount}% OFF (-â‚¬${(product.preco - product.promocao).toFixed(2)})\n`;
    text += `De â‚¬${product.preco.toFixed(2)} â†’ â‚¬${product.promocao.toFixed(2)}\n\n`;
  } else if (product.preco) {
    text += `ğŸ’µ â‚¬${product.preco.toFixed(2)}\n\n`;
  }
  
  text += `ğŸ‘‰ Ver oferta: ${product.link}\n\nâš ï¸ Esgota rÃ¡pido!`;
  
  return encodeURIComponent(text);
}

function generateStockWarning() {
  const warnings = [
    "ğŸ”¥ Ãšltimas 3 unidades",
    "âš¡ Esgota hoje",
    "ğŸƒ Vende rÃ¡pido",
    "â° Oferta acaba em breve",
    "ğŸ”¥ Stock limitado"
  ];
  return warnings[Math.floor(Math.random() * warnings.length)];
}

// ============ RENDER FUNCTIONS ============
function renderSkeletonCard() {
  return `
    <article class="bg-white rounded-2xl p-4 overflow-hidden shadow">
      <div class="skeleton h-52 rounded-xl mb-3"></div>
      <div class="skeleton h-4 rounded mb-2" style="width: 85%"></div>
      <div class="skeleton h-4 rounded mb-3" style="width: 65%"></div>
      <div class="flex justify-between items-center">
        <div class="skeleton h-7 rounded" style="width: 80px"></div>
        <div class="skeleton h-10 rounded-lg" style="width: 110px"></div>
      </div>
    </article>
  `;
}

function showLoadingSkeleton() {
  const skeleton = document.getElementById('loadingSkeleton');
  const grid = document.getElementById('grid');
  skeleton.innerHTML = Array(8).fill(renderSkeletonCard()).join('');
  skeleton.classList.remove('hidden');
  grid.classList.add('hidden');
}

function hideLoadingSkeleton() {
  const skeleton = document.getElementById('loadingSkeleton');
  const grid = document.getElementById('grid');
  skeleton.classList.add('hidden');
  grid.classList.remove('hidden');
}

function renderCard(p, index) {
  const price = p.preco != null ? `â‚¬${p.preco.toFixed(2)}` : 'â€”';
  const promo = (p.promocao != null && p.preco != null && p.promocao < p.preco) ? `â‚¬${p.promocao.toFixed(2)}` : null;
  const discount = (promo && p.preco && p.promocao) ? Math.round((1 - p.promocao / p.preco) * 100) : 0;
  const savings = (promo && p.preco && p.promocao) ? (p.preco - p.promocao).toFixed(2) : 0;
  const img = p.imagem || 'https://via.placeholder.com/400x400?text=Produto';
  const link = p.link || '#';
  const destaqueClass = (p.destaque && p.destaque.toLowerCase() === 'sim') || discount >= 50 ? 'destaque' : '';
  const isNewProduct = isNew(p.dataAdicionado);
  const stockWarning = discount >= 40 ? generateStockWarning() : '';
  const shareText = getShareText(p);
  const whatsappLink = `https://wa.me/?text=${shareText}`;
  
  return `
    <article class="bg-white rounded-2xl p-5 product-card ${destaqueClass} relative shadow-lg hover:shadow-2xl">
      
      <!-- Badges -->
      <div class="absolute top-3 right-3 flex flex-col gap-2 z-10">
        ${isNewProduct ? `
          <div class="badge-novo text-white px-3 py-1 rounded-full text-xs font-black shadow-lg">
            NOVO ğŸ”¥
          </div>
        ` : ''}
        ${stockWarning ? `
          <div class="badge-esgota text-white px-3 py-1 rounded-full text-xs font-black shadow-lg">
            ${stockWarning}
          </div>
        ` : ''}
      </div>
      
      <!-- Image -->
      <a href="${link}" target="_blank" rel="noopener sponsored" class="block relative overflow-hidden rounded-xl mb-4 bg-gray-50">
        <img loading="lazy" src="${img}" alt="${p.titulo}" class="w-full h-56 object-contain hover:scale-110 transition-transform duration-300" />
        ${promo ? `
          <div class="absolute top-3 left-3 bg-gradient-to-r from-red-600 to-red-500 text-white px-4 py-2 rounded-full text-base font-black shadow-xl">
            -${discount}%
          </div>
        ` : ''}
      </a>
      
      <!-- Title -->
      <h3 class="text-sm font-bold leading-tight mb-3 h-12 overflow-hidden text-gray-900" title="${p.titulo}">
        ${p.titulo.length > 70 ? p.titulo.substring(0, 70) + '...' : p.titulo}
      </h3>
      
      <!-- Category -->
      <div class="text-xs text-gray-500 mb-3 flex items-center gap-1">
        <span class="text-base">${CATEGORY_ICONS[p.categoria] || CATEGORY_ICONS.default}</span>
        <span class="font-semibold">${p.categoria || 'Geral'}</span>
      </div>
      
      <!-- Price Section -->
      <div class="mb-4">
        ${promo && p.preco && p.promocao ? `
          <div class="text-sm text-gray-500 line-through mb-1">${price}</div>
          <div class="text-2xl font-black text-green-600 mb-1">${promo}</div>
          <div class="text-sm text-green-700 font-bold">
            Poupas â‚¬${savings} âœ¨
          </div>
        ` : `
          <div class="text-2xl font-black text-gray-900">${price}</div>
        `}
      </div>
      
      <!-- CTAs -->
      <div class="flex flex-col gap-2">
        <a 
          href="${link}" 
          target="_blank" 
          rel="noopener sponsored" 
          class="cta-primary px-6 py-3 rounded-xl text-base font-black text-gray-900 text-center shadow-lg block"
        >
          ${discount >= 50 ? 'ğŸ”¥ APROVEITAR AGORA' : 'ğŸ›’ Ver na Amazon'}
        </a>
        <button 
          onclick="shareProduct('${whatsappLink}')" 
          class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl text-sm font-bold transition-all shadow"
        >
          ğŸ“± Partilhar oferta
        </button>
      </div>
    </article>
  `;
}

function renderGrid(list) {
  const grid = document.getElementById('grid');
  if (list.length === 0) {
    grid.innerHTML = `
      <div class="col-span-full text-center py-20">
        <div class="text-8xl mb-6">ğŸ˜”</div>
        <h3 class="text-2xl font-black text-gray-800 mb-3">Nenhuma oferta encontrada</h3>
        <p class="text-gray-600 mb-6">Tenta ajustar os filtros ou pesquisa</p>
        <button onclick="location.reload()" class="cta-primary px-8 py-4 rounded-xl font-black text-lg shadow-xl">
          ğŸ”„ Ver todas as ofertas
        </button>
      </div>
    `;
  } else {
    grid.innerHTML = list.map((p, i) => renderCard(p, i)).join('');
  }
}

function renderStats(total) {
  document.getElementById('statsCount').textContent = total;
  const liveCount = document.getElementById('liveCount');
  if (liveCount) {
    liveCount.textContent = `${total} ofertas ativas`;
  }
}

function renderPagination(totalItems) {
  const pages = Math.max(1, Math.ceil(totalItems / PAGE_SIZE));
  const nav = document.getElementById('pagination');
  
  if (pages <= 1) {
    nav.innerHTML = '';
    return;
  }
  
  let html = '';
  const start = Math.max(1, currentPage - 2);
  const end = Math.min(pages, currentPage + 2);
  
  if (currentPage > 1) {
    html += `<button onclick="gotoPage(${currentPage-1})" class="px-5 py-3 bg-white border-2 border-gray-300 rounded-xl hover:border-yellow-400 hover:bg-yellow-50 transition-all font-bold shadow">â† Anterior</button>`;
  }
  
  for (let i = start; i <= end; i++) {
    const active = i === currentPage 
      ? 'bg-gradient-to-r from-yellow-400 to-orange-400 text-white border-yellow-500 shadow-lg' 
      : 'bg-white border-gray-300 hover:border-yellow-400 hover:bg-yellow-50';
    html += `<button onclick="gotoPage(${i})" class="px-5 py-3 ${active} border-2 rounded-xl transition-all font-bold shadow">${i}</button>`;
  }
  
  if (currentPage < pages) {
    html += `<button onclick="gotoPage(${currentPage+1})" class="px-5 py-3 bg-white border-2 border-gray-300 rounded-xl hover:border-yellow-400 hover:bg-yellow-50 transition-all font-bold shadow">PrÃ³ximo â†’</button>`;
  }
  
  nav.innerHTML = html;
}

// ============ FILTER & SORT ============
function gotoPage(n) {
  currentPage = n;
  applyFiltersAndRender();
  window.scrollTo({ top: 300, behavior: 'smooth' });
}

function applyFiltersAndRender() {
  const q = document.getElementById('search').value.trim().toLowerCase();
  const cat = document.getElementById('categoryFilter').value;
  const sort = document.getElementById('sortSelect').value;

  let filtered = PRODUCTS.filter(p => {
    const inCat = !cat || (p.categoria && p.categoria.toLowerCase() === cat.toLowerCase());
    const inQ = !q || (p.titulo && p.titulo.toLowerCase().includes(q));
    return inCat && inQ;
  });

  if (sort === 'price_asc') {
    filtered.sort((a,b) => (a.promocao || a.preco || 0) - (b.promocao || b.preco || 0));
  } else if (sort === 'price_desc') {
    filtered.sort((a,b) => (b.promocao || b.preco || 0) - (a.promocao || a.preco || 0));
  } else if (sort === 'promo_desc') {
    filtered.sort((a,b) => {
      const discA = a.preco && a.promocao ? (a.preco - a.promocao) : 0;
      const discB = b.preco && b.promocao ? (b.preco - b.promocao) : 0;
      return discB - discA;
    });
  } else if (sort === 'newest') {
    filtered.sort((a,b) => (b.dataAdicionado || 0) - (a.dataAdicionado || 0));
  }

  renderStats(filtered.length);
  renderPagination(filtered.length);

  const start = (currentPage - 1) * PAGE_SIZE;
  const pageItems = filtered.slice(start, start + PAGE_SIZE);
  renderGrid(pageItems);
}

function populateCategories() {
  const set = new Set();
  PRODUCTS.forEach(p => {
    if (p.categoria) set.add(p.categoria.trim());
  });
  
  const sel = document.getElementById('categoryFilter');
  const sortedCats = Array.from(set).sort();
  
  sortedCats.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    const icon = CATEGORY_ICONS[c] || CATEGORY_ICONS.default;
    opt.textContent = `${icon} ${c}`;
    sel.appendChild(opt);
  });
}

// ============ SHARE ============
function shareProduct(whatsappLink) {
  window.open(whatsappLink, '_blank');
}

// ============ SCROLL TO TOP ============
window.addEventListener('scroll', () => {
  const scrollTop = document.getElementById('scrollTop');
  if (window.pageYOffset > 400) {
    scrollTop.classList.add('show');
  } else {
    scrollTop.classList.remove('show');
  }
});

// ============ INIT ============
async function init() {
  showLoadingSkeleton();
  startCountdown();
  
  try {
    const data = await fetchProducts();
    
    PRODUCTS = data.map(p => ({
      titulo: p.titulo || '',
      imagem: p.imagem || '',
      preco: toNumber(p.preco),
      promocao: toNumber(p.promocao),
      link: p.link || '',
      categoria: p.categoria || '',
      destaque: p.destaque || '',
      dataAdicionado: parseDate(p.enviado) || new Date()
    }));
    
    hideLoadingSkeleton();
    populateCategories();
    applyFiltersAndRender();
    
  } catch(e) {
    console.error('Erro:', e);
    hideLoadingSkeleton();
    document.getElementById('grid').innerHTML = `
      <div class="col-span-full text-center py-20">
        <div class="text-8xl mb-6">âš ï¸</div>
        <h3 class="text-2xl font-black text-gray-800 mb-3">Erro ao carregar ofertas</h3>
        <p class="text-gray-600 mb-6">Por favor, recarrega a pÃ¡gina</p>
        <button onclick="location.reload()" class="cta-primary px-8 py-4 rounded-xl font-black text-lg shadow-xl">
          ğŸ”„ Recarregar
        </button>
      </div>
    `;
  }
}

// Event Listeners
document.getElementById('search').addEventListener('input', () => {
  currentPage = 1;
  applyFiltersAndRender();
});

document.getElementById('categoryFilter').addEventListener('change', () => {
  currentPage = 1;
  applyFiltersAndRender();
});

document.getElementById('sortSelect').addEventListener('change', () => {
  currentPage = 1;
  applyFiltersAndRender();
});

// Start
init();
</script>

</body>
</html>
