<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>üî• Descontos Amazon at√© 74% HOJE | PromoZon Portugal</title>
  
  <!-- SEO -->
  <meta name="description" content="Ofertas Amazon verificadas a cada hora. At√© 74% desconto. Frete GR√ÅTIS. Produtos esgotam r√°pido!">
  <meta name="keywords" content="descontos amazon, ofertas rel√¢mpago amazon, promo√ß√µes amazon portugal, black friday amazon">
  
  <!-- Open Graph -->
  <meta property="og:title" content="üî• Descontos Amazon at√© 74% - S√≥ Hoje!">
  <meta property="og:description" content="Ofertas verificadas. Poupa at√© ‚Ç¨200! Esgota r√°pido.">
  <meta property="og:image" content="https://your-domain.com/og-image.jpg">
  
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(250, 204, 21, 0.5); }
      50% { box-shadow: 0 0 40px rgba(250, 204, 21, 0.8); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }
    
    @keyframes countdown-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .product-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: fadeIn 0.5s ease-out;
    }
    
    .product-card:hover {
      transform: translateY(-12px) scale(1.03);
      box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    }
    
    .destaque {
      border: 4px solid #facc15;
      animation: pulse-glow 2s ease-in-out infinite;
      position: relative;
      background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
    }
    
    .destaque::before {
      content: '‚≠ê MELHOR NEG√ìCIO';
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      color: #000;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 900;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .hero-gradient {
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 50%, #ea580c 100%);
    }
    
    .badge-novo {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      animation: shake 0.5s ease-in-out infinite;
    }
    
    .badge-esgota {
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      animation: countdown-pulse 1s ease-in-out infinite;
    }
    
    .trust-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-size: 13px;
      font-weight: 600;
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s ease-in-out infinite;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .cta-primary {
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .cta-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
    }
    
    .cta-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }
    
    .cta-primary:hover::before {
      left: 100%;
    }
    
    #scrollTop {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      color: #000;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 1000;
      font-size: 24px;
      font-weight: bold;
    }
    
    #scrollTop.show {
      opacity: 1;
    }
    
    #scrollTop:hover {
      transform: translateY(-6px);
    }
    
    .countdown-timer {
      font-family: 'Courier New', monospace;
      font-size: 16px;
      font-weight: bold;
      color: #dc2626;
    }
    
    @media (min-width: 768px) {
      .countdown-timer {
        font-size: 20px;
        display: block;
      }
    }
    
    @media (max-width: 640px) {
      .hero-section h1 {
        font-size: 24px;
      }
      .hero-section h2 {
        font-size: 28px !important;
      }
      .hero-section p {
        font-size: 16px !important;
      }
      .hero-gradient {
        padding: 24px 16px !important;
      }
      .trust-badge {
        font-size: 11px;
        padding: 6px 12px;
      }
      .countdown-timer {
        font-size: 18px;
      }
      .header-controls {
        flex-direction: column;
        width: 100%;
      }
      .header-controls > * {
        width: 100%;
        margin-bottom: 8px;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- Trust Bar (topo fixo) -->
<div class="bg-gradient-to-r from-green-600 to-green-500 text-white text-center py-2 text-sm font-semibold">
  ‚úÖ Ofertas verificadas a cada hora | üöö Frete GR√ÅTIS em muitos produtos | ‚≠ê Garantia Amazon
</div>

<!-- Header -->
<header class="bg-white shadow-lg sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center space-x-3">
        <img src="logox.png" alt="PromoHunter" class="h-14 w-14 md:h-16 md:w-16">
        <div>
          <h1 class="text-2xl md:text-3xl font-black bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent">
            PromoHunter
          </h1>
          <p class="text-xs md:text-sm text-gray-600 font-semibold">Atualizado a cada hora</p>
        </div>
      </div>
      
      <div class="hidden md:flex items-center space-x-4 text-sm">
        <div class="flex items-center space-x-2 bg-green-50 px-3 py-2 rounded-lg">
          <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          <span class="text-green-700 font-bold" id="liveCount">0 ofertas ativas</span>
        </div>
      </div>
    </div>
    
    <!-- Filters -->
    <div class="header-controls flex items-center gap-3">
      <input 
        id="search" 
        type="text"
        placeholder="üîç O que procuras? Ex: Aspirador, TV..." 
        class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none transition-all text-base font-medium" 
      />
      <select id="categoryFilter" class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none bg-white text-base font-medium">
        <option value="">üìÅ Todas</option>
      </select>
      <select id="sortSelect" class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none bg-white text-base font-medium">
        <option value="promo_desc">üî• Maior desconto</option>
        <option value="price_asc">üí∞ Mais barato</option>
        <option value="price_desc">üíé Mais caro</option>
        <option value="newest">üÜï Mais recentes</option>
      </select>
    </div>
  </div>
</header>

<!-- Hero Section - GameRunlocked Style -->
<section class="relative overflow-hidden bg-gradient-to-br from-gray-900 via-gray-800 to-black py-16 md:py-24">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-10">
    <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23facc15\" fill-opacity=\"0.4\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
  </div>
  
  <!-- Gradient Overlay -->
  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-gray-900/50 to-gray-900"></div>
  
  <div class="relative max-w-7xl mx-auto px-4">
    <div class="grid md:grid-cols-2 gap-8 items-center">
      
      <!-- Left Column - Text Content -->
      <div class="text-left space-y-6 z-10">
        <!-- Label Badge -->
        <div class="inline-flex items-center gap-2 bg-yellow-400/10 border border-yellow-400/30 rounded-full px-4 py-2 backdrop-blur-sm">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-yellow-400"></span>
          </span>
          <span class="text-yellow-400 text-sm font-bold uppercase tracking-wider">Ofertas Verificadas Diariamente</span>
        </div>
        
        <!-- Main Heading -->
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-black text-white leading-none">
          Poupa at√©
          <span class="block text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 mt-2">
            70% OFF
          </span>
          <span class="block text-white text-3xl md:text-4xl mt-4">
            em produtos Amazon
          </span>
        </h1>
        
        <!-- Subtitle -->
        <p class="text-gray-300 text-lg md:text-xl max-w-lg leading-relaxed">
          As melhores ofertas da Amazon Portugal, atualizadas a cada hora. 
          <span class="text-yellow-400 font-semibold">Esgotam r√°pido!</span>
        </p>
        
        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 pt-4">
          <a href="#grid" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-black text-gray-900 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl overflow-hidden transition-all hover:scale-105 hover:shadow-2xl hover:shadow-yellow-500/50">
            <span class="relative z-10 flex items-center gap-2">
              üî• Ver Todas as Ofertas
              <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
              </svg>
            </span>
          </a>
          
          <button onclick="document.getElementById('categoryFilter').focus()" class="inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-white bg-white/10 backdrop-blur-sm border-2 border-white/20 rounded-xl hover:bg-white/20 hover:border-white/40 transition-all">
            <span class="flex items-center gap-2">
              üìÅ Explorar Categorias
            </span>
          </button>
        </div>
        
        <!-- Stats Bar -->
        <div class="flex flex-wrap gap-6 pt-6 border-t border-white/10">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center justify-center">
              <span class="text-2xl">‚úì</span>
            </div>
            <div>
              <div class="text-white font-bold text-lg" id="heroStatsCount">0+</div>
              <div class="text-gray-400 text-sm">Ofertas Ativas</div>
            </div>
          </div>
          
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-blue-500/10 border border-blue-500/30 rounded-xl flex items-center justify-center">
              <span class="text-2xl">üöö</span>
            </div>
            <div>
              <div class="text-white font-bold text-lg">Gr√°tis</div>
              <div class="text-gray-400 text-sm">Frete em Muitos</div>
            </div>
          </div>
          
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-yellow-500/10 border border-yellow-500/30 rounded-xl flex items-center justify-center">
              <span class="text-2xl">‚ö°</span>
            </div>
            <div>
              <div class="text-white font-bold text-lg countdown-timer-hero" id="countdownHero">--:--</div>
              <div class="text-gray-400 text-sm">Pr√≥x. Atualiza√ß√£o</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Column - Visual Element -->
      <div class="hidden md:block relative">
        <!-- Floating Cards Animation -->
        <div class="relative h-96">
          <!-- Card 1 - Top -->
          <div class="absolute top-0 right-0 w-64 bg-gradient-to-br from-gray-800 to-gray-900 border border-yellow-400/30 rounded-2xl p-4 shadow-2xl shadow-yellow-500/20 animate-float" style="animation-delay: 0s;">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center text-white font-black text-lg">
                -63%
              </div>
              <div class="flex-1">
                <div class="text-white font-bold text-sm">Aspirador Robot</div>
                <div class="text-gray-400 text-xs">Xiaomi</div>
              </div>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-gray-500 line-through text-sm">‚Ç¨299</span>
              <span class="text-yellow-400 font-black text-xl">‚Ç¨110</span>
            </div>
          </div>
          
          <!-- Card 2 - Middle -->
          <div class="absolute top-24 left-0 w-56 bg-gradient-to-br from-gray-800 to-gray-900 border border-orange-400/30 rounded-2xl p-4 shadow-2xl shadow-orange-500/20 animate-float" style="animation-delay: 0.5s;">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center text-white font-black text-lg">
                -48%
              </div>
              <div class="flex-1">
                <div class="text-white font-bold text-sm">Smart TV 32"</div>
                <div class="text-gray-400 text-xs">Samsung</div>
              </div>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-gray-500 line-through text-sm">‚Ç¨249</span>
              <span class="text-orange-400 font-black text-xl">‚Ç¨129</span>
            </div>
          </div>
          
          <!-- Card 3 - Bottom -->
          <div class="absolute bottom-0 right-8 w-60 bg-gradient-to-br from-gray-800 to-gray-900 border border-green-400/30 rounded-2xl p-4 shadow-2xl shadow-green-500/20 animate-float" style="animation-delay: 1s;">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center text-white font-black text-lg">
                -55%
              </div>
              <div class="flex-1">
                <div class="text-white font-bold text-sm">Auscultadores BT</div>
                <div class="text-gray-400 text-xs">Sony</div>
              </div>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-gray-500 line-through text-sm">‚Ç¨180</span>
              <span class="text-green-400 font-black text-xl">‚Ç¨81</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Bottom Wave -->
  <div class="absolute bottom-0 left-0 right-0">
    <svg class="w-full h-16 md:h-24 text-gray-50" viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
      <path d="M0,64L80,69.3C160,75,320,85,480,80C640,75,800,53,960,48C1120,43,1280,53,1360,58.7L1440,64L1440,120L1360,120C1280,120,1120,120,960,120C800,120,640,120,480,120C320,120,160,120,80,120L0,120Z" fill="currentColor"/>
    </svg>
  </div>
</section>

<style>
@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(1deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.countdown-timer-hero {
  font-family: 'Courier New', monospace;
  font-size: 16px;
  font-weight: bold;
}
</style>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 py-8">
  
  <!-- Stats Bar -->
  <section class="mb-6 flex items-center justify-between bg-white rounded-xl px-6 py-4 shadow">
    <div>
      <span class="text-3xl font-black text-yellow-600" id="statsCount">0</span>
      <span class="text-gray-600 font-semibold ml-2">ofertas encontradas</span>
    </div>
    <div class="text-sm text-gray-500 hidden md:block">
      üí° <strong>Dica:</strong> Produtos com desconto >50% esgotam em minutos!
    </div>
  </section>
  
  <!-- Loading Skeleton -->
  <section id="loadingSkeleton" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <!-- Filled by JS -->
  </section>
  
  <!-- Products Grid -->
  <section id="grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 hidden"></section>
  
  <!-- Pagination -->
  <nav id="pagination" class="mt-12 flex justify-center items-center gap-2"></nav>
</main>

<!-- Social Proof Section -->
<section class="bg-gradient-to-r from-blue-50 to-purple-50 py-16 mt-16">
  <div class="max-w-6xl mx-auto px-4 text-center">
    <h3 class="text-3xl font-black text-gray-900 mb-8">J√° pouparam milhares de euros üí∞</h3>
    <div class="grid md:grid-cols-3 gap-8">
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="text-5xl mb-4">üòç</div>
        <p class="text-gray-700 italic mb-4">"Comprei o aspirador que queria h√° meses por -63%! Incr√≠vel!"</p>
        <p class="font-bold text-gray-900">‚Äî Maria, Lisboa</p>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="text-5xl mb-4">üî•</div>
        <p class="text-gray-700 italic mb-4">"Todos os dias encontro ofertas novas. J√° poupei +‚Ç¨300 este m√™s."</p>
        <p class="font-bold text-gray-900">‚Äî Jo√£o, Porto</p>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <div class="text-5xl mb-4">‚ö°</div>
        <p class="text-gray-700 italic mb-4">"Melhor que Black Friday! Verificam os pre√ßos, confio 100%."</p>
        <p class="font-bold text-gray-900">‚Äî Ana, Braga</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-gray-900 text-white mt-16 py-12">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <div class="mb-6">
      <h2 class="text-2xl font-black text-yellow-400 mb-2">PromoHunter</h2>
      <p class="text-gray-400">As melhores ofertas Amazon, verificadas para ti</p>
    </div>
    
    <div class="flex flex-wrap justify-center gap-6 mb-6 text-sm">
      <a href="#" class="hover:text-yellow-400 transition">Sobre N√≥s</a>
      <a href="#" class="hover:text-yellow-400 transition">Como Funciona</a>
      <a href="#" class="hover:text-yellow-400 transition">Pol√≠tica de Privacidade</a>
      <a href="#" class="hover:text-yellow-400 transition">Contacto</a>
    </div>
    
    <p class="text-xs text-gray-500">
      ‚ö†Ô∏è Os pre√ßos s√£o atualizados regularmente. Confirme sempre o pre√ßo final na Amazon.<br>
      PromoHunter √© um afiliado Amazon. Ganhamos comiss√£o em compras qualificadas.
    </p>
    
    <p class="text-xs text-gray-600 mt-4">
      ¬© 2026 PromoHunter. Criado com ‚ù§Ô∏è para poupar o teu dinheiro.
    </p>
  </div>
</footer>

<!-- Scroll to Top -->
<button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Voltar ao topo">
  ‚Üë
</button>

<script>
// ============ CONFIG ============
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzXV2COi6q6327Son0xN9pXKK3vWkmMc0FRp6m25MXzJsBbqg80GAR_qvNhP9pFW9JzWA/exec';
const PAGE_SIZE = 24;
const HOURS_FOR_NEW_BADGE = 48;
const NEXT_UPDATE_HOURS = 1; // Pr√≥xima atualiza√ß√£o em 1h

let PRODUCTS = [];
let currentPage = 1;

const CATEGORY_ICONS = {
  'Electr√≥nica': 'üíª',
  'Cocina y Hogar': 'üè†',
  'Animais PET': 'üêæ',
  'Ferramentas Electricas': 'üîß',
  'Desporto': '‚öΩ',
  'Beleza': 'üíÑ',
  'Sa√∫de e Lar': 'üè•',
  'default': 'üì¶'
};

// ============ COUNTDOWN TIMER ============
function startCountdown() {
  const updateCountdown = () => {
    const now = new Date();
    const nextHour = new Date(now);
    nextHour.setHours(now.getHours() + NEXT_UPDATE_HOURS, 0, 0, 0);
    
    const diff = nextHour - now;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const secs = Math.floor((diff % (1000 * 60)) / 1000);
    
    const display = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    const displayShort = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    
    const countdownEl = document.getElementById('countdown');
    const countdownHeroEl = document.getElementById('countdownHero');
    
    if (countdownEl) countdownEl.textContent = display;
    if (countdownHeroEl) countdownHeroEl.textContent = displayShort;
  };
  
  updateCountdown();
  setInterval(updateCountdown, 1000);
}

// ============ UTILITIES ============
function fetchProducts() {
  return fetch(WEB_APP_URL).then(res => res.json());
}

function toNumber(v) {
  if (!v) return null;
  let s = String(v).trim().replace(',', '.').replace(/[^0-9.\-]/g, '');
  const n = parseFloat(s);
  return isNaN(n) ? null : n;
}

function parseDate(dateStr) {
  if (!dateStr) return null;
  const formats = [
    /(\d{1,2})\/(\d{1,2})\/(\d{4})/,
    /(\d{4})-(\d{2})-(\d{2})/,
  ];
  for (const format of formats) {
    const match = String(dateStr).match(format);
    if (match) {
      if (format === formats[0]) {
        return new Date(match[3], match[2] - 1, match[1]);
      } else {
        return new Date(match[1], match[2] - 1, match[3]);
      }
    }
  }
  return null;
}

function isNew(dateAdded) {
  if (!dateAdded) return false;
  const now = new Date();
  const diff = now - dateAdded;
  const hours = diff / (1000 * 60 * 60);
  return hours <= HOURS_FOR_NEW_BADGE;
}

function getShareText(product) {
  const discount = product.promocao && product.preco 
    ? Math.round((1 - product.promocao / product.preco) * 100)
    : 0;
  
  let text = `üî• OFERTA AMAZON!\n\n${product.titulo}\n\n`;
  
  if (discount > 0 && product.preco && product.promocao) {
    text += `üí∞ ${discount}% OFF (-‚Ç¨${(product.preco - product.promocao).toFixed(2)})\n`;
    text += `De ‚Ç¨${product.preco.toFixed(2)} ‚Üí ‚Ç¨${product.promocao.toFixed(2)}\n\n`;
  } else if (product.preco) {
    text += `üíµ ‚Ç¨${product.preco.toFixed(2)}\n\n`;
  }
  
  text += `üëâ Ver oferta: ${product.link}\n\n‚ö†Ô∏è Esgota r√°pido!`;
  
  return encodeURIComponent(text);
}

function generateStockWarning() {
  const warnings = [
    "üî• √öltimas 3 unidades",
    "‚ö° Esgota hoje",
    "üèÉ Vende r√°pido",
    "‚è∞ Oferta acaba em breve",
    "üî• Stock limitado"
  ];
  return warnings[Math.floor(Math.random() * warnings.length)];
}

// ============ RENDER FUNCTIONS ============
function renderSkeletonCard() {
  return `
    <article class="bg-white rounded-2xl p-4 overflow-hidden shadow">
      <div class="skeleton h-52 rounded-xl mb-3"></div>
      <div class="skeleton h-4 rounded mb-2" style="width: 85%"></div>
      <div class="skeleton h-4 rounded mb-3" style="width: 65%"></div>
      <div class="flex justify-between items-center">
        <div class="skeleton h-7 rounded" style="width: 80px"></div>
        <div class="skeleton h-10 rounded-lg" style="width: 110px"></div>
      </div>
    </article>
  `;
}

function showLoadingSkeleton() {
  const skeleton = document.getElementById('loadingSkeleton');
  const grid = document.getElementById('grid');
  skeleton.innerHTML = Array(8).fill(renderSkeletonCard()).join('');
  skeleton.classList.remove('hidden');
  grid.classList.add('hidden');
}

function hideLoadingSkeleton() {
  const skeleton = document.getElementById('loadingSkeleton');
  const grid = document.getElementById('grid');
  skeleton.classList.add('hidden');
  grid.classList.remove('hidden');
}

function renderCard(p, index) {
  const price = p.preco != null ? `‚Ç¨${p.preco.toFixed(2)}` : '‚Äî';
  const promo = (p.promocao != null && p.preco != null && p.promocao < p.preco) ? `‚Ç¨${p.promocao.toFixed(2)}` : null;
  const discount = (promo && p.preco && p.promocao) ? Math.round((1 - p.promocao / p.preco) * 100) : 0;
  const savings = (promo && p.preco && p.promocao) ? (p.preco - p.promocao).toFixed(2) : 0;
  const img = p.imagem || 'https://via.placeholder.com/400x400?text=Produto';
  const link = p.link || '#';
  const destaqueClass = (p.destaque && p.destaque.toLowerCase() === 'sim') || discount >= 50 ? 'destaque' : '';
  const isNewProduct = isNew(p.dataAdicionado);
  const stockWarning = discount >= 40 ? generateStockWarning() : '';
  const shareText = getShareText(p);
  const whatsappLink = `https://wa.me/?text=${shareText}`;
  
  return `
    <article class="bg-white rounded-2xl p-5 product-card ${destaqueClass} relative shadow-lg hover:shadow-2xl">
      
      <!-- Badges -->
      <div class="absolute top-3 right-3 flex flex-col gap-2 z-10">
        ${isNewProduct ? `
          <div class="badge-novo text-white px-3 py-1 rounded-full text-xs font-black shadow-lg">
            NOVO üî•
          </div>
        ` : ''}
        ${stockWarning ? `
          <div class="badge-esgota text-white px-3 py-1 rounded-full text-xs font-black shadow-lg">
            ${stockWarning}
          </div>
        ` : ''}
      </div>
      
      <!-- Image -->
      <a href="${link}" target="_blank" rel="noopener sponsored" class="block relative overflow-hidden rounded-xl mb-4 bg-gray-50">
        <img loading="lazy" src="${img}" alt="${p.titulo}" class="w-full h-56 object-contain hover:scale-110 transition-transform duration-300" />
        ${promo ? `
          <div class="absolute top-3 left-3 bg-gradient-to-r from-red-600 to-red-500 text-white px-4 py-2 rounded-full text-base font-black shadow-xl">
            -${discount}%
          </div>
        ` : ''}
      </a>
      
      <!-- Title -->
      <h3 class="text-sm font-bold leading-tight mb-3 h-12 overflow-hidden text-gray-900" title="${p.titulo}">
        ${p.titulo.length > 70 ? p.titulo.substring(0, 70) + '...' : p.titulo}
      </h3>
      
      <!-- Category -->
      <div class="text-xs text-gray-500 mb-3 flex items-center gap-1">
        <span class="text-base">${CATEGORY_ICONS[p.categoria] || CATEGORY_ICONS.default}</span>
        <span class="font-semibold">${p.categoria || 'Geral'}</span>
      </div>
      
      <!-- Price Section -->
      <div class="mb-4">
        ${promo && p.preco && p.promocao ? `
          <div class="text-sm text-gray-500 line-through mb-1">${price}</div>
          <div class="text-2xl font-black text-green-600 mb-1">${promo}</div>
          <div class="text-sm text-green-700 font-bold">
            Poupas ‚Ç¨${savings} ‚ú®
          </div>
        ` : `
          <div class="text-2xl font-black text-gray-900">${price}</div>
        `}
      </div>
      
      <!-- CTAs -->
      <div class="flex flex-col gap-2">
        <a 
          href="${link}" 
          target="_blank" 
          rel="noopener sponsored" 
          class="cta-primary px-6 py-3 rounded-xl text-base font-black text-gray-900 text-center shadow-lg block"
        >
          ${discount >= 50 ? 'üî• APROVEITAR AGORA' : 'üõí Ver na Amazon'}
        </a>
        <button 
          onclick="shareProduct('${whatsappLink}')" 
          class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl text-sm font-bold transition-all shadow"
        >
          üì± Partilhar oferta
        </button>
      </div>
    </article>
  `;
}

function renderGrid(list) {
  const grid = document.getElementById('grid');
  if (list.length === 0) {
    grid.innerHTML = `
      <div class="col-span-full text-center py-20">
        <div class="text-8xl mb-6">üòî</div>
        <h3 class="text-2xl font-black text-gray-800 mb-3">Nenhuma oferta encontrada</h3>
        <p class="text-gray-600 mb-6">Tenta ajustar os filtros ou pesquisa</p>
        <button onclick="location.reload()" class="cta-primary px-8 py-4 rounded-xl font-black text-lg shadow-xl">
          üîÑ Ver todas as ofertas
        </button>
      </div>
    `;
  } else {
    grid.innerHTML = list.map((p, i) => renderCard(p, i)).join('');
  }
}

function renderStats(total) {
  document.getElementById('statsCount').textContent = total;
  const liveCount = document.getElementById('liveCount');
  const heroStatsCount = document.getElementById('heroStatsCount');
  
  if (liveCount) {
    liveCount.textContent = `${total} ofertas ativas`;
  }
  if (heroStatsCount) {
    heroStatsCount.textContent = `${total}+`;
  }
}

function renderPagination(totalItems) {
  const pages = Math.max(1, Math.ceil(totalItems / PAGE_SIZE));
  const nav = document.getElementById('pagination');
  
  if (pages <= 1) {
    nav.innerHTML = '';
    return;
  }
  
  let html = '';
  const start = Math.max(1, currentPage - 2);
  const end = Math.min(pages, currentPage + 2);
  
  if (currentPage > 1) {
    html += `<button onclick="gotoPage(${currentPage-1})" class="px-5 py-3 bg-white border-2 border-gray-300 rounded-xl hover:border-yellow-400 hover:bg-yellow-50 transition-all font-bold shadow">‚Üê Anterior</button>`;
  }
  
  for (let i = start; i <= end; i++) {
    const active = i === currentPage 
      ? 'bg-gradient-to-r from-yellow-400 to-orange-400 text-white border-yellow-500 shadow-lg' 
      : 'bg-white border-gray-300 hover:border-yellow-400 hover:bg-yellow-50';
    html += `<button onclick="gotoPage(${i})" class="px-5 py-3 ${active} border-2 rounded-xl transition-all font-bold shadow">${i}</button>`;
  }
  
  if (currentPage < pages) {
    html += `<button onclick="gotoPage(${currentPage+1})" class="px-5 py-3 bg-white border-2 border-gray-300 rounded-xl hover:border-yellow-400 hover:bg-yellow-50 transition-all font-bold shadow">Pr√≥ximo ‚Üí</button>`;
  }
  
  nav.innerHTML = html;
}

// ============ FILTER & SORT ============
function gotoPage(n) {
  currentPage = n;
  applyFiltersAndRender();
  window.scrollTo({ top: 300, behavior: 'smooth' });
}

function applyFiltersAndRender() {
  const q = document.getElementById('search').value.trim().toLowerCase();
  const cat = document.getElementById('categoryFilter').value;
  const sort = document.getElementById('sortSelect').value;

  let filtered = PRODUCTS.filter(p => {
    const inCat = !cat || (p.categoria && p.categoria.toLowerCase() === cat.toLowerCase());
    const inQ = !q || (p.titulo && p.titulo.toLowerCase().includes(q));
    return inCat && inQ;
  });

  if (sort === 'price_asc') {
    filtered.sort((a,b) => (a.promocao || a.preco || 0) - (b.promocao || b.preco || 0));
  } else if (sort === 'price_desc') {
    filtered.sort((a,b) => (b.promocao || b.preco || 0) - (a.promocao || a.preco || 0));
  } else if (sort === 'promo_desc') {
    filtered.sort((a,b) => {
      const discA = a.preco && a.promocao ? (a.preco - a.promocao) : 0;
      const discB = b.preco && b.promocao ? (b.preco - b.promocao) : 0;
      return discB - discA;
    });
  } else if (sort === 'newest') {
    filtered.sort((a,b) => (b.dataAdicionado || 0) - (a.dataAdicionado || 0));
  }

  renderStats(filtered.length);
  renderPagination(filtered.length);

  const start = (currentPage - 1) * PAGE_SIZE;
  const pageItems = filtered.slice(start, start + PAGE_SIZE);
  renderGrid(pageItems);
}

function populateCategories() {
  const set = new Set();
  PRODUCTS.forEach(p => {
    if (p.categoria) set.add(p.categoria.trim());
  });
  
  const sel = document.getElementById('categoryFilter');
  const sortedCats = Array.from(set).sort();
  
  sortedCats.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    const icon = CATEGORY_ICONS[c] || CATEGORY_ICONS.default;
    opt.textContent = `${icon} ${c}`;
    sel.appendChild(opt);
  });
}

// ============ SHARE ============
function shareProduct(whatsappLink) {
  window.open(whatsappLink, '_blank');
}

// ============ SCROLL TO TOP ============
window.addEventListener('scroll', () => {
  const scrollTop = document.getElementById('scrollTop');
  if (window.pageYOffset > 400) {
    scrollTop.classList.add('show');
  } else {
    scrollTop.classList.remove('show');
  }
});

// ============ INIT ============
async function init() {
  showLoadingSkeleton();
  startCountdown();
  
  try {
    const data = await fetchProducts();
    
    PRODUCTS = data.map(p => ({
      titulo: p.titulo || '',
      imagem: p.imagem || '',
      preco: toNumber(p.preco),
      promocao: toNumber(p.promocao),
      link: p.link || '',
      categoria: p.categoria || '',
      destaque: p.destaque || '',
      dataAdicionado: parseDate(p.enviado) || new Date()
    }));
    
    hideLoadingSkeleton();
    populateCategories();
    applyFiltersAndRender();
    
  } catch(e) {
    console.error('Erro:', e);
    hideLoadingSkeleton();
    document.getElementById('grid').innerHTML = `
      <div class="col-span-full text-center py-20">
        <div class="text-8xl mb-6">‚ö†Ô∏è</div>
        <h3 class="text-2xl font-black text-gray-800 mb-3">Erro ao carregar ofertas</h3>
        <p class="text-gray-600 mb-6">Por favor, recarrega a p√°gina</p>
        <button onclick="location.reload()" class="cta-primary px-8 py-4 rounded-xl font-black text-lg shadow-xl">
          üîÑ Recarregar
        </button>
      </div>
    `;
  }
}

// Event Listeners
document.getElementById('search').addEventListener('input', () => {
  currentPage = 1;
  applyFiltersAndRender();
});

document.getElementById('categoryFilter').addEventListener('change', () => {
  currentPage = 1;
  applyFiltersAndRender();
});

document.getElementById('sortSelect').addEventListener('change', () => {
  currentPage = 1;
  applyFiltersAndRender();
});

// Start
init();
</script>

</body>
</html>
